<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book.title }} - Batafsil</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <h1>{{ book.title }}</h1>
        <a href="{% url 'index' %}" class="back-btn">← Ortga</a>
    </header>

    <div class="book-detail">
        <img src="{{ book.image.url }}" alt="{{ book.title }}">
        <div class="book-info">
            <h2>{{ book.title }}</h2>
            <p><strong>Muallif:</strong> {{ book.author }}</p>
            <p><strong>Janrlar:</strong> 
                {% for genre in book.genre.all %}
                    {{ genre.name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
            <!-- <p><strong>Nashr yili:</strong> {{ book.year }}</p> -->
            <p class="description">{{ book.description }}</p>
        </div>
        <button class="like-btn" data-book-id="{{ book.id }}" data-liked="{{ liked|yesno:'true,false' }}">
            {% if liked %} ❤️ Liked {% else %} ❤️ {% endif %}
        </button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll(".like-btn").forEach(button => {
                let isLiked = button.getAttribute("data-liked") === "true";
    
                if (isLiked) {
                    button.innerHTML = "❤️ Liked";
                }
    
                button.addEventListener("click", function() {
                    let bookId = this.getAttribute("data-book-id");
                    let likeButton = this;
    
                    fetch(`/like/${bookId}/`, {
                        method: "GET",
                        headers: {
                            "X-Requested-With": "XMLHttpRequest"
                        },
                        credentials: "same-origin"
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.liked) {
                            likeButton.innerHTML = "❤️ Liked";
                            likeButton.setAttribute("data-liked", "true");
                        } else {
                            likeButton.innerHTML = "❤️";
                            likeButton.setAttribute("data-liked", "false");
                        }
                    });
                });
            });
        });
    </script>
</body>
</html>
